<!doctype html>
<html>
  <head>
    <title>Knitpicker</title>
    <script src="https://unpkg.com/react@18.3/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18.3/umd/react-dom.production.min.js"></script>
    <style>
      #inputContainer {
        display: flex;
      }
      #stitchInput {
        flex: 1;
        min-height: 96px;
      }
      #colorInputs {
        flex: 1;
      }

      #stitchContainer {
        width: 100%;
        display: grid;
        gap: 0;

        background-color: #bbb;
      }
      .stitch {
        aspect-ratio: 1 / 1;
        border: 1px solid #ccc;
      }
    </style>
  </head>

  <body>
    <div id="appContainer"></div>

    <script src="app.js"></script>
    <script>
      const params = new URLSearchParams(window.location.search)

      // Initialize custom colors
      const customColors = {}
      for (const [key, value] of params.entries()) {
        if (key.startsWith('color_')) {
          const colorKey = key.substring(6) // Remove 'color_' prefix
          customColors[`--color-${colorKey}`] = value
        }
      }

      // Initialize textarea from URL parameter or default
      (async () => {
        if (params.has('stitches')) {
          const input = params.get('stitches')
          return decodeGzip(input).catch(() => {
            // If the input fails to decode, use it as is.
            return input
          })
        } else {
          return "A A A B A A A B\nA A B A A A B A\nA B A A A B A A\nB A A A B A A A\n"
        }
      })().then((defaultInput) => {
        ReactDOM.createRoot(
          document.getElementById('appContainer')
        ).render(
          createElement(App, {
            defaultInput,
            defaultCustomColors: customColors
          })
        )
      })
    </script>
  </body>
</html>
